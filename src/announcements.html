<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“¢ All Announcements</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 min-h-screen text-gray-900">

  <div class="max-w-7xl mx-auto py-12 px-6">
    <!-- Heading -->
    <h1 class="text-4xl md:text-5xl font-extrabold text-center text-white drop-shadow mb-10">
      Department Announcements
    </h1>

    <!-- Announcements Container -->
    <div id="announcements-container" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
      <!-- Dynamic cards will load here -->
    </div>
  </div>

  <script>
    async function loadAnnouncements() {
      try {
        const res = await fetch("/api/announcements");
        const announcements = await res.json();

        const container = document.getElementById("announcements-container");
        container.innerHTML = "";

        if (!announcements || announcements.length === 0) {
          container.innerHTML = `
            <div class="col-span-full text-center text-white bg-white/20 backdrop-blur p-6 rounded-2xl shadow-lg">
              No announcements available ðŸ“­
            </div>`;
          return;
        }

        announcements.forEach(a => {
          let fileSection = "";
          if (a.file_url) {
            if (a.file_type && a.file_type.startsWith("image/")) {
              fileSection = `<img src="${a.file_url}" class="rounded-xl shadow-md mt-4 max-h-52 w-full object-cover"/>`;
            } else if (a.file_type === "application/pdf") {
              fileSection = `
                <div class="mt-4">
                  <object data="${a.file_url}" type="application/pdf"
                          class="w-full h-64 rounded-lg border"></object>
                  <a href="${a.file_url}" download
                     class="mt-3 inline-block px-5 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg shadow">
                     â¬‡ Download PDF
                  </a>
                </div>`;
            } else {
              fileSection = `
                <a href="${a.file_url}" download
                   class="mt-4 inline-block px-5 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow">
                   ðŸ“Ž Download File
                </a>`;
            }
          }

          const card = document.createElement("div");
          card.className =
            "bg-white/90 backdrop-blur rounded-2xl shadow-xl p-6 flex flex-col justify-between hover:scale-[1.02] transition-transform duration-200";

          card.innerHTML = `
            <div>
              <h2 class="text-lg font-bold text-gray-800">${a.title}</h2>
              <p class="text-xs text-gray-500 mt-1">By ${a.faculty_name || "Faculty"} â€¢ 
                 ${new Date(a.created_at).toLocaleString()}</p>
              <p class="text-gray-700 mt-3 whitespace-pre-line">${a.message || ""}</p>
              ${fileSection}
            </div>
          `;

          container.appendChild(card);
        });
      } catch (err) {
        console.error("Error loading announcements:", err);
        alert("Failed to load announcements.");
      }
    }

    document.addEventListener("DOMContentLoaded", loadAnnouncements);
  </script>
</body>

</html>